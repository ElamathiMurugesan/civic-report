<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Report Center Dashboard</title>
  <link rel="stylesheet" href="admindashboard.css">

</head>
<body>
<div class="container">
  <aside class="sidebar">
    <div class="profile">
      <div class="avatar">RC</div>
      <div>
        <h1 class="title">Report Center</h1>
        <p class="subtitle">Admin</p>
      </div>
    </div>
    <nav class="menu">
      <a href="admindashboard.html" class="menu-item active">Dashboard</a>
      <a href="analytics.html" class="menu-item">Report Analytics</a>
      <a href="notification.html" class="menu-item">Notifications</a>
    </nav>
  </aside>

  <main class="content">
    <h2 class="heading">Dashboard</h2>

    <div class="stats">
      <div class="card">
        <p class="label">Total Reports</p>
        <p class="value" id="adminTotalReports">0</p>
      </div>
      <div class="card">
        <p class="label">Pending</p>
        <p class="value" id="adminPendingReports">0</p>
      </div>
      <div class="card">
        <p class="label">In Progress</p>
        <p class="value" id="adminInProgressReports">0</p>
      </div>
      <div class="card">
        <p class="label">Resolved</p>
        <p class="value" id="adminResolvedReports">0</p>
      </div>
    </div>
<script>
function getAdminReportCounts() {
  const reports = JSON.parse(localStorage.getItem('reports') || '[]').filter(r => r.category && r.category.trim() !== '');
  const total = reports.length;
  const pending = reports.filter(r => r.status === 'pending').length;
  const inProgress = reports.filter(r => r.status === 'in progress' || r.status === 'onprocess').length;
  const resolved = reports.filter(r => r.status === 'resolved' || r.status === 'completed').length;
  return { total, pending, inProgress, resolved };
}

function updateAdminStats() {
  const counts = getAdminReportCounts();
  document.getElementById('adminTotalReports').textContent = counts.total;
  document.getElementById('adminPendingReports').textContent = counts.pending;
  document.getElementById('adminInProgressReports').textContent = counts.inProgress;
  document.getElementById('adminResolvedReports').textContent = counts.resolved;
}

// Call on load and after status change
document.addEventListener('DOMContentLoaded', updateAdminStats);
// Patch into status change in renderAdminReportsGrid
const origRenderAdminReportsGrid = window.renderAdminReportsGrid;
window.renderAdminReportsGrid = function() {
  origRenderAdminReportsGrid();
  updateAdminStats();
};
</script>

    <div class="grid">
      <div class="reports">
        <h3 class="subheading">All Reports</h3>
        <div id="adminReportsGrid" class="admin-reports-grid"></div>
      </div>

      <div class="map">
        <h3 class="subheading">Map View</h3>
        <div class="map-container"></div>
      </div>
    </div>
  </main>
</div>
<style>
.admin-reports-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 24px;
  margin-top: 18px;
}
.admin-report-card {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 2px 12px rgba(44,62,80,0.09);
  padding: 22px 20px 18px 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  border: 1px solid #e0e7ef;
  position: relative;
  transition: box-shadow 0.18s;
}
.admin-report-card:hover {
  box-shadow: 0 6px 24px rgba(44,62,80,0.16);
}
.admin-report-title {
  font-size: 1.2rem;
  font-weight: 600;
  color: #2e7d6b;
  margin-bottom: 2px;
}
.admin-report-meta {
  font-size: 0.98rem;
  color: #4b5563;
}
.admin-report-status {
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.admin-status-select {
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid #b2dfdb;
  font-size: 1rem;
  background: #f0f7f4;
  color: #2e7d6b;
  outline: none;
  transition: border 0.2s;
}
.admin-status-select:focus {
  border: 1.5px solid #2e7d6b;
}
.admin-report-label {
  font-size: 0.97rem;
  color: #888;
  font-weight: 500;
}
</style>
<script>
function prettyStatus(status) {
  if (!status) return '';
  if (status === 'in progress' || status === 'onprocess') return 'In Progress';
  if (status === 'resolved' || status === 'completed') return 'Resolved';
  return status.charAt(0).toUpperCase() + status.slice(1);
}

function renderAdminReportsGrid() {
  const grid = document.getElementById('adminReportsGrid');
  // Only show reports with a non-empty category
  const reports = JSON.parse(localStorage.getItem('reports') || '[]').filter(r => r.category && r.category.trim() !== '');
  if (!reports.length) {
    grid.innerHTML = '<div style="color:#888;text-align:center;">No reports found.</div>';
    return;
  }
  grid.innerHTML = reports.map((r, idx) => `
    <div class="admin-report-card">
      <div class="admin-report-title">${r.title || ''}</div>
      <div class="admin-report-meta"><span class="admin-report-label">ID:</span> #${r.id || ''}</div>
      <div class="admin-report-meta"><span class="admin-report-label">Category:</span> ${r.category || ''}</div>
      <div class="admin-report-meta"><span class="admin-report-label">Location:</span> ${r.location || ''}</div>
      <div class="admin-report-meta"><span class="admin-report-label">Reporter:</span> ${r.userEmail || ''}</div>
      <div class="admin-report-meta"><span class="admin-report-label">Date:</span> ${r.date || ''}</div>
      <div class="admin-report-status">
        <span class="admin-report-label">Status:</span>
        <select data-idx="${idx}" class="admin-status-select">
          <option value="pending" ${r.status === 'pending' ? 'selected' : ''}>Pending</option>
          <option value="in progress" ${(r.status === 'in progress' || r.status === 'onprocess') ? 'selected' : ''}>In Progress</option>
          <option value="resolved" ${(r.status === 'resolved' || r.status === 'completed') ? 'selected' : ''}>Resolved</option>
        </select>
      </div>
      <div class="admin-report-meta" style="font-size:0.97rem;color:#555;margin-top:6px;">${r.description || ''}</div>
    </div>
  `).join('');

  // Add event listeners for status change
  grid.querySelectorAll('.admin-status-select').forEach((sel, idx) => {
    sel.addEventListener('change', function() {
      // Find the correct report in the filtered list, then update the original reports array
      const filteredReports = JSON.parse(localStorage.getItem('reports') || '[]').filter(r => r.category && r.category.trim() !== '');
      const allReports = JSON.parse(localStorage.getItem('reports') || '[]');
      const reportToUpdate = filteredReports[idx];
      if (reportToUpdate) {
        // Find the index in the original array
        const origIdx = allReports.findIndex(r => r.id === reportToUpdate.id);
        if (origIdx !== -1) {
          allReports[origIdx].status = this.value;
          localStorage.setItem('reports', JSON.stringify(allReports));
          renderAdminReportsGrid();
        }
      }
    });
  });
}

document.addEventListener('DOMContentLoaded', renderAdminReportsGrid);
</script>
</body>
</html>
